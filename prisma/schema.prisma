generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
  extensions = [uuid_ossp(map: "uuid-ossp")]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  
}

model Users {
  id                    String               @id @default(uuid()) @db.Uuid
  username              String               @unique
  password              String
  email                 String?              @db.VarChar(150)
  f_name                String               @db.VarChar(50)
  m_name                String?              @db.VarChar(50)
  l_name                String?              @db.VarChar(50)
  phone                 String               @db.VarChar(20)
  landline              String?              @default("") @db.VarChar(20)
  alt_landline          String?              @default("") @db.VarChar(20)
  alt_phone             String?              @default("") @db.VarChar(20)
  designation           String?              @default("") @db.VarChar(50)
  city                  String?              @default("")
  zip_code              String?              @default("")
  state                 String?              @default("")
  country               String?              @default("")
  address               String?              @default("")
  role                  UserRole
  emp_code              String?              @default("WBT")
  is_sales              Boolean?             @default(false)
  is_manager            Boolean              @default(false)
  is_active             Boolean              @default(true)
  is_staff              Boolean              @default(false)
  is_superuser          Boolean              @default(false)
  is_firstLogin         Boolean              @default(true)
  fabricatorId          String?              @db.Uuid
  department            String?              @db.Uuid
  is_systemadmin        Boolean              @default(false)
  is_deptmanager        Boolean              @default(false)
  is_hr                 Boolean              @default(false)
  is_oe                 Boolean              @default(false)
  is_pmo                Boolean              @default(false)
  is_disabled           Boolean              @default(false)
  is_est                Boolean              @default(false)
  is_estHead            Boolean              @default(false)
  is_supermanager       Boolean              @default(false)
  updatedAt             DateTime             @default(now()) @updatedAt
  COrespondedby         COResponse[]         @relation("COrespondedby")
  accepttasks           AcceptTask[]         @relation("acceptTaskUser")
  taskApprovedBy        Assigned_list[]      @relation("taskApprovedBy")
  taskAssignedby        Assigned_list[]      @relation("taskAssignedby")
  assignedToUsers       Assigned_list[]      @relation("assignedToUsers")
  approvedByUser        Assignes[]           @relation("approvedByUser")
  assignedByUser        Assignes[]           @relation("assignedByUser")
  assignedToUser        Assignes[]           @relation("assignedToUser")
  changeorderRecipients ChangeOrder[]        @relation("ChangeOrderRecipients")
  changeorderSender     ChangeOrder[]        @relation("ChangeOrderSender")
  taskcommentuser       Comment[]            @relation("taskcommentuser")
  approvedByConfirm     Confirm[]            @relation("approvedByUserConfirm")
  assignedByConfirm     Confirm[]            @relation("assignedByUserConfirm")
  assignedToConfirm     Confirm[]            @relation("assignedToUserConfirm")
  createdDepartments    Department[]         @relation("Creator")
  managedDepartments    Department[]         @relation("Manager")
  assignedEstimations   EstimationTask[]     @relation("AssignedEstimator")
  AssignedByEstimations EstimationTask[]     @relation("AssignedBy")
  reviewedEstimations   EstimationTask[]     @relation("ReviewedBy")
  createdEstimations    Estimation[]         @relation("CreatedBy")
  createdFabricators    Fabricator[]         @relation("FabricatorCreatedBy")
  groupAdmin            Group[]              @relation("groupAdmin")
  groupMembers          GroupUser[]          @relation("groupMembers")
  messageReceivedBy     Message[]            @relation("messageReceivedBy")
  messageSentBy         Message[]            @relation("messageSentBy")
  notification          Notification[]       @relation("Notification")
  project               Project[]            @relation("projectManager")
  rfiRecepients         RFI[]                @relation("UsersRFI")
  rfisender             RFI[]                @relation("senderRFI")
  rfiresponseBy         RFIResponse[]        @relation("rfiresponseBy")
  UsersRFQ              RFQ[]                @relation("UsersRFQ")
  salesRfqs             RFQ[]                @relation("SalesPersonRFQ")
  senderRFQ             RFQ[]                @relation("senderRFQ")
  rfqresponseBy         RFQResponse[]        @relation("rfqresponseBy")
  submittalRecepients   Submittals[]         @relation("UsersSubmittals")
  submittalsender       Submittals[]         @relation("senderSubmittals")
  submittalsresponseBy  SubmittalsResponse[] @relation("submittalsresponseBy")
  tasks                 Task[]               @relation("userTask")
  teamManager           Team[]               @relation("TeamManager")
  departmentId          Department?          @relation("userDepartment", fields: [department], references: [id], onDelete: Cascade)
  fabricator            Fabricator?          @relation("UsersFabricator", fields: [fabricatorId], references: [id])
  workingHourUser       WorkingHours[]       @relation("workingHourUser")
  fabricators           Fabricator[]         @relation("FabricatorUsers")
  taggedInMessages      Message[]            @relation("TaggedUsers")
  POC                   Project[]            @relation("POC")
  meetingsCreated Meeting[]          @relation("MeetingCreatedBy") 
  meetingAttendees MeetingAttendee[] @relation("MeetingAttendeeUser")
  notes             Notes[]           @relation("NotesCreatedBy")
  designdrawingsuser DesignDrawings[] @relation("designdrawingsuser")
  designdrawingsresponseBy DesignDrawingsResponses[] @relation("designDrawingsresponseBy")
  invoicePointOfContact     Invoice[]     @relation("invoicePointOfContact")
  invoices                  Invoice[]     @relation("invoiceCreatedBy")
  @@map("users")
}

model Meeting {
  id          String            @id @default(uuid()) @db.Uuid
  title       String
  agenda      String
  description String?
  link        String
  startTime   DateTime
  endTime     DateTime?
  files       Json         @default("[]")
  status      MeetingStatus            @default(SCHEDULED) // optional
  reminderSent Boolean @default(false)


  // relation to who created the meeting
  createdById String            @db.Uuid
  createdBy   Users             @relation("MeetingCreatedBy", fields: [createdById], references: [id])

  participants MeetingAttendee[]

  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}

model MeetingAttendee {
  id        String   @id @default(uuid())
  meetingId String   @db.Uuid
  userId    String?  @db.Uuid // nullable in case external emails are invited
  email     String
  rsvp      RSVPStatus  
  joined    Boolean     @default(false) // true if they actually attended
  role      MeetingRole @default(ATTENDEE) // role in the meeting

  meeting   Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  user      Users?   @relation("MeetingAttendeeUser", fields: [userId], references: [id])
}

model Fabricator {
  id          String       @id @default(uuid()) @db.Uuid
  createdById String       @db.Uuid
  fabName     String       @default("")
  headquaters Json         @default("{}")
  website     String?      @default("")
  drive       String?      @default("")
  branches    Json         @default("[]")
  is_bin      Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  files       Json         @default("[]")
  isArchived  Boolean      @default(false)
  currencyType String       @default("")
  accepttasks AcceptTask[] @relation("acceptTaskFabricator")
  estimation  Estimation[] @relation("estimationUnderFabricator")
  createdBy   Users        @relation("FabricatorCreatedBy", fields: [createdById], references: [id], onDelete: Cascade)
  file        File[]       @relation("fabricatorFiles")
  project     Project[]    @relation("projectFabricator")
  rfi         RFI[]        @relation("FabricatorRFI")
  submittals  Submittals[] @relation("FabricatorSubmittals")
  userss      Users[]      @relation("UsersFabricator")
  users       Users[]      @relation("FabricatorUsers")
  RFQ         RFQ[]       @relation("FabricatorRFQ")
  mileStone   MileStone[] @relation("FabricatorMileStone")
  invoice     Invoice[]   @relation("fabricatorInvoice")

  @@map("fabricators")
}

model Department {
  id          String    @id @default(uuid()) @db.Uuid
  name        String    @unique
  managerId   String?   @db.Uuid
  createdById String?   @db.Uuid
  isBin       Boolean   @default(false)
  createdBy   Users?    @relation("Creator", fields: [createdById], references: [id])
  manager     Users?    @relation("Manager", fields: [managerId], references: [id])
  project     Project[] @relation("projectDepartment")
  users       Users[]   @relation("userDepartment")

  @@map("department")
}

model Team {
  id           String    @id @default(uuid()) @db.Uuid
  name         String    @unique
  managerID    String    @db.Uuid
  members      Json      @default("[]")
  departmentID String?
  project      Project[] @relation("projectTeam")
  manager      Users     @relation("TeamManager", fields: [managerID], references: [id], onDelete: Cascade)

  @@map("team")
}

model Project {
  id                     String        @id @default(uuid()) @db.Uuid
  name                   String        @unique
  description            String
  rfqId                  String?         @unique @db.Uuid 
  projectNumber          String?       @unique  
  fabricatorID           String        @db.Uuid
  clientId               String?        @db.Uuid
  departmentID           String        @db.Uuid
  teamID                 String?       @db.Uuid
  managerID              String        @db.Uuid
  status                 Status        @default(ACTIVE)
  stage                  Stage         @default(RFI)
  tools                  Tools         @default(NO_PREFERENCE)
  files                  Json          @default("[]")
  connectionDesign       Boolean       @default(false)
  miscDesign             Boolean       @default(false)
  customerDesign         Boolean       @default(false)
  detailingMain          Boolean       @default(false)
  detailingMisc          Boolean       @default(false)
  startDate              String
  endDate                String?
  endDateChangeLog       Json          @default("[]")
  approvalDateChangeLog  Json          @default("[]")
  stageHistory           ProjectStageHistory[]
  approvalDate           String
  estimatedHours         Float?        @default(0)
  detailCheckingHours    Float         @default(0)
  detailingHours         Float         @default(0)
  executionCheckingHours Float         @default(0)
  executionHours         Float         @default(0)
  modelCheckingHours     Float         @default(0)
  modelingHours          Float         @default(0)
  mailReminder           Boolean       @default(false)
  submissionMailReminder Boolean       @default(false)
  isArchived             Boolean      @default(false)
  accepttasks            AcceptTask[]  @relation("acceptTaskProject")
  changeOrder            ChangeOrder[] @relation("ChangeOrderProject")
  file                   File[]        @relation("projectFiles")
  Jobstudy               JobStudy[]    @relation("projectJobStudy")
  department             Department    @relation("projectDepartment", fields: [departmentID], references: [id], onDelete: Cascade)
  fabricator             Fabricator    @relation("projectFabricator", fields: [fabricatorID], references: [id], onDelete: Cascade)
  manager                Users         @relation("projectManager", fields: [managerID], references: [id], onDelete: Cascade)
  pointOfContact         Users?         @relation("POC",fields:[clientId],references:[id])
  team                   Team?         @relation("projectTeam", fields: [teamID], references: [id], onDelete: Cascade)
  rfi                    RFI[]         @relation("ProjectRFI")
  subTasks               SubTasks[]    @relation("subTasksproject")
  submittals             Submittals[]  @relation("ProjectSubmittals")
  tasks                  Task[]        @relation("projectTask")
  wbsActivities          WBSActivity[]  
  mileStones             MileStone[]   @relation("ProjectMileStone")
  notes                  Notes[]        @relation("projectNotes")
  rfq                    RFQ?          @relation("ProjectRFQ", fields: [rfqId], references: [id], onDelete: Cascade)
  designDrawings         DesignDrawings[] @relation("designdrawingsproject")
  invoice                 Invoice[]       @relation("projectInvoice")
  @@map("project")
}

model Notes{
  id                     String         @id @default(uuid()) @db.Uuid
  content                String   
  stage                  Stage?        @default(RFI)            
  files                  Json?           @default("[]")
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt
  createdById            String?         @db.Uuid

  createdBy              Users?          @relation("NotesCreatedBy",fields: [createdById],references: [id])
  projectId              String         @db.Uuid
  project                Project        @relation("projectNotes",fields:[projectId],references:[id])
  @@map("notes")
}


model ProjectStageHistory {
  id         String   @id @default(uuid()) @db.Uuid
  projectID  String   @db.Uuid
  stage      Stage
  startDate  DateTime @default(now())
  endDate    DateTime?

  project    Project  @relation(fields: [projectID], references: [id], onDelete: Cascade)

  @@map("project_stage_history")
}

model Task {
  id                 String          @id @default(uuid()) @db.Uuid
  name               String
  description        String
  status             String
  priority           Int
  created_on         DateTime        @default(now())
  reworkStartTime    DateTime?
  due_date           String
  duration           String
  userFault          String          @default("")
  project_id         String          @db.Uuid
  user_id            String          @db.Uuid
  mileStone_id        String?         @db.Uuid
  start_date         String
  Stage              Stage           @default(IFA)
  changeOrderNumber  Int?            @default(0)
  isArchived         Boolean      @default(false)
  mileStone          MileStone?        @relation("mileStoneTasks", fields: [mileStone_id], references: [id], onDelete: Cascade)
  taskInAssignedList Assigned_list[] @relation("taskInAssignedList")
  assignedTask       Assignes[]      @relation("assignedTask")
  taskcomment        Comment[]       @relation("taskcomment")
  project            Project         @relation("projectTask", fields: [project_id], references: [id], onDelete: Cascade)
  user               Users           @relation("userTask", fields: [user_id], references: [id], onDelete: Cascade)
  workingHourTask    WorkingHours[]  @relation("workingHourTask")

  @@map("task")
}

model AcceptTask {
  id            String     @id @default(uuid()) @db.Uuid
  name          String
  description   String
  satus         String
  attachment    String
  priority      Int
  created_on    DateTime   @default(now())
  due_date      DateTime
  duration      String
  project_id    String     @db.Uuid
  fabricator_id String     @db.Uuid
  user_id       String     @db.Uuid
  fabricator    Fabricator @relation("acceptTaskFabricator", fields: [fabricator_id], references: [id], onDelete: Cascade)
  project       Project    @relation("acceptTaskProject", fields: [project_id], references: [id], onDelete: Cascade)
  user          Users      @relation("acceptTaskUser", fields: [user_id], references: [id], onDelete: Cascade)

  @@map("accepttask")
}

model Assigned_list {
  id          String    @id @default(uuid()) @db.Uuid
  approved_on DateTime?
  assigned_on DateTime  @default(now())
  approved    Boolean
  comment     String    @default(" ")
  task_id     String    @db.Uuid
  assigned_by String    @db.Uuid
  approved_by String?   @db.Uuid
  assigned_to String    @db.Uuid
  user        Users?    @relation("taskApprovedBy", fields: [approved_by], references: [id], onDelete: Cascade)
  users       Users     @relation("taskAssignedby", fields: [assigned_by], references: [id], onDelete: Cascade)
  userss      Users     @relation("assignedToUsers", fields: [assigned_to], references: [id], onDelete: Cascade)
  task        Task      @relation("taskInAssignedList", fields: [task_id], references: [id], onDelete: Cascade)
  confirm     Confirm[] @relation("assignedTaskConfirm")

  @@map("assigendlist")
}

model Assignes {
  id          String   @id @default(uuid()) @db.Uuid
  approved_on DateTime @default(now())
  assigned_on DateTime @default(now())
  approved    Boolean  @default(true)
  comment     String   @default("")
  task_id     String   @db.Uuid
  assigned_by String   @db.Uuid
  assigned_to String   @db.Uuid
  approved_by String?  @db.Uuid
  userss      Users?   @relation("approvedByUser", fields: [approved_by], references: [id], onDelete: Cascade)
  users       Users    @relation("assignedByUser", fields: [assigned_by], references: [id], onDelete: Cascade)
  user        Users    @relation("assignedToUser", fields: [assigned_to], references: [id], onDelete: Cascade)
  task        Task     @relation("assignedTask", fields: [task_id], references: [id], onDelete: Cascade)

  @@map("assignes")
}

model Confirm {
  id               String        @id @default(uuid()) @db.Uuid
  approved_on      DateTime      @default(now())
  assigned_on      DateTime      @default(now())
  approved         Boolean       @default(false)
  comment          String
  assigned_task_id String        @db.Uuid
  assigned_by      String        @db.Uuid
  assigned_to      String        @db.Uuid
  approved_by      String        @db.Uuid
  userss           Users         @relation("approvedByUserConfirm", fields: [approved_by], references: [id], onDelete: Cascade)
  users            Users         @relation("assignedByUserConfirm", fields: [assigned_by], references: [id], onDelete: Cascade)
  task             Assigned_list @relation("assignedTaskConfirm", fields: [assigned_task_id], references: [id], onDelete: Cascade)
  user             Users         @relation("assignedToUserConfirm", fields: [assigned_to], references: [id], onDelete: Cascade)

  @@map("confirm")
}

model Comment {
  id                 String    @id @default(uuid()) @db.Uuid
  created_on         DateTime  @default(now())
  data               String
  task_id            String?    @db.Uuid
  user_id            String    @db.Uuid
  file               Json      @default("[]")
  acknowledged       Boolean   @default(false)
  acknowledgedTime   DateTime?
  estimation_task_id String?   
  estimationTaskId   String?    @db.Uuid
  estimationTask     EstimationTask?   @relation("estComment",fields:[estimationTaskId],references:[id],onDelete:Cascade)
  task               Task?      @relation("taskcomment", fields: [task_id], references: [id], onDelete: Cascade)
  user               Users     @relation("taskcommentuser", fields: [user_id], references: [id], onDelete: Cascade)

  @@map("comment")
}
model DesignDrawings{
  id          String   @id @default(uuid()) @db.Uuid
  projectId   String   @db.Uuid
  stage       Stage    @default(RFI)
  description String   @default("")
  files       Json     @default("[]")
  uploadedBy  String   @db.Uuid
  uploadedAt  DateTime @default(now())
  project     Project  @relation("designdrawingsproject",fields: [projectId], references: [id], onDelete: Cascade)
  user        Users    @relation("designdrawingsuser",fields: [uploadedBy], references: [id], onDelete: Cascade)
  responses   DesignDrawingsResponses[] @relation("designDrawingsresponse")

  @@map("designdrawings")
}

model DesignDrawingsResponses{
  id                String          @id @default(uuid()) @db.Uuid
  designDrawingsId String          @db.Uuid
  files            Json            @default("[]")
  reason           String          @default("")
  respondedAt      DateTime        @default(now())
  createdAt        DateTime        @default(now())
  userId           String          @db.Uuid
  description      String          @default("")
  status           SubResStatus    @default(NOT_APPROVED)
  wbtStatus        State           @default(RECEIVED)
  parentResponseId String?         @db.Uuid
  parentResponse   DesignDrawingsResponses? @relation("ParentChildResponse", fields: [parentResponseId], references: [id],onDelete: Cascade)
  childResponses   DesignDrawingsResponses[] @relation("ParentChildResponse")
  designDrawings   DesignDrawings  @relation("designDrawingsresponse", fields: [designDrawingsId], references: [id], onDelete: Cascade)
  user             Users           @relation("designDrawingsresponseBy", fields: [userId], references: [id])

  @@map("designdrawingsresponses")
}
model Submittals {
  id                 String              @id @default(uuid()) @db.Uuid
  fabricator_id      String              @db.Uuid
  mileStoneId      String?               @db.Uuid 
  date               DateTime            @default(now())
  project_id         String              @db.Uuid
  recepient_id       String              @db.Uuid
  sender_id          String              @db.Uuid
  status             Boolean             @default(false)
  stage              Stage               @default(IFA)
  subject            String
  description        String
  files              Json              @default("[]")
  isAproovedByAdmin  Boolean?   @default(false)
  isDeputyManagerAprooved     Boolean?         @default(false)
  isDeptManagerAprooved       Boolean?         @default(false)
  mileStoneBelongsTo MileStone?          @relation("mileStoneSubmittals", fields: [mileStoneId], references: [id], onDelete: Cascade)
  file               File[]              @relation("submittalsFiles")
  fabricator         Fabricator          @relation("FabricatorSubmittals", fields: [fabricator_id], references: [id], onDelete: Cascade)
  project            Project             @relation("ProjectSubmittals", fields: [project_id], references: [id], onDelete: Cascade)
  recepients         Users               @relation("UsersSubmittals", fields: [recepient_id], references: [id], onDelete: Cascade)
  sender             Users               @relation("senderSubmittals", fields: [sender_id], references: [id], onDelete: Cascade)
  submittalsResponse SubmittalsResponse[] @relation("submittalsresponse")

  @@map("submittals")
}
model MileStone{
  id                 String              @id @default(uuid()) @db.Uuid
  fabricator_id      String              @db.Uuid
  date               DateTime            @default(now())
  project_id         String              @db.Uuid
  approvalDate      DateTime?
  status             Status             @default(ACTIVE)
  stage              Stage              @default(IFA)
  subject            String
  percentage         String             @default("")
  description        String
  //relations
  fabricator         Fabricator          @relation("FabricatorMileStone", fields: [fabricator_id], references: [id], onDelete: Cascade)
  project            Project             @relation("ProjectMileStone", fields: [project_id], references: [id], onDelete: Cascade)
  mileStoneSubmittals Submittals[]       @relation("mileStoneSubmittals")
  Tasks             Task[]              @relation("mileStoneTasks") 
}
model SubmittalsResponse {
  id               String               @id @default(uuid()) @db.Uuid
  files            Json               @default("[]")
  reason           String               @default("")
  respondedAt      String               @default("")
  createdAt        DateTime             @default(now())
  submittalsId     String               @db.Uuid
  userId           String               @db.Uuid
  description      String               @default("")
  status           SubResStatus         @default(NOT_APPROVED)
  wbtStatus        State                @default(RECEIVED)
  parentResponseId String?              @db.Uuid
  file             File[]               @relation("submittalsResponseFiles")
  parentResponse   SubmittalsResponse?  @relation("ParentChildResponse", fields: [parentResponseId], references: [id],onDelete: Cascade)
  childResponses   SubmittalsResponse[] @relation("ParentChildResponse")
  submittals       Submittals           @relation("submittalsresponse", fields: [submittalsId], references: [id],onDelete: Cascade)
  user             Users                @relation("submittalsresponseBy", fields: [userId], references: [id])

  @@map("submittalsresponse")
}

model RFI {
  id            String       @id @default(uuid()) @db.Uuid
  fabricator_id String       @db.Uuid
  date          DateTime     @default(now())
  project_id    String       @db.Uuid
  recepient_id  String       @db.Uuid
  sender_id     String       @db.Uuid
  status        Boolean      @default(false)
  subject       String
  description   String
  files         Json       @default("[]")
  isAproovedByAdmin   Boolean?   @default(false)
  isDeputyManagerAprooved     Boolean?         @default(false)
  isDeptManagerAprooved       Boolean?         @default(false)
  file          File[]       @relation("rfiFiles")
  fabricator    Fabricator   @relation("FabricatorRFI", fields: [fabricator_id], references: [id], onDelete: Cascade)
  project       Project      @relation("ProjectRFI", fields: [project_id], references: [id], onDelete: Cascade)
  recepients    Users        @relation("UsersRFI", fields: [recepient_id], references: [id], onDelete: Cascade)
  sender        Users        @relation("senderRFI", fields: [sender_id], references: [id], onDelete: Cascade)
  rfiresponse   RFIResponse[] @relation("rfiresponse")

  @@map("rfi")
}

model RFIResponse {
  id               String        @id @default(uuid()) @db.Uuid
  files            Json        @default("[]")
  responseState    State         @default(SENT)
  wbtStatus        State         @default(RECEIVED)
  reason           String        @default("")
  respondedAt      DateTime      @default(now())
  createdAt        DateTime      @default(now())
  rfiId            String        @db.Uuid
  userId           String        @db.Uuid
  parentResponseId String?       @db.Uuid
  file             File[]        @relation("rfiResponseFiles")
  parentResponse   RFIResponse?  @relation("ParentChildResponse", fields: [parentResponseId], references: [id],onDelete: Cascade)
  childResponses   RFIResponse[] @relation("ParentChildResponse")
  rfi              RFI           @relation("rfiresponse", fields: [rfiId], references: [id], onDelete: Cascade)
  user             Users         @relation("rfiresponseBy", fields: [userId], references: [id])

  @@map("rfiresponse")
}

model RFQ {
  id               String        @id @default(uuid()) @db.Uuid
  projectName      String
  projectNumber    String?       @unique
  sender_id        String?        @db.Uuid
  fabricatorId     String?        @db.Uuid
  subject          String
  description      String
  files            Json        @default("[]")
  recepient_id     String        @db.Uuid
  status           RFQStatus     @default(RECEIVED)
  createdAt        DateTime      @default(now())
  estimationDate   DateTime?
  tools            String?
  bidPrice         String?
  createdById      String?
  updatedAt        DateTime      @default(now()) @updatedAt
  salesPersonId    String?       @db.Uuid
  connectionDesign Boolean       @default(false)
  customerDesign   Boolean       @default(false)
  miscDesign       Boolean       @default(false)
  detailingMain    Boolean       @default(false)
  detailingMisc    Boolean       @default(false)
  estimations      Estimation[]
  fabricators      Fabricator?    @relation("FabricatorRFQ", fields: [fabricatorId], references: [id])
  file             File[]        @relation("rfqFiles")
  recepients       Users         @relation("UsersRFQ", fields: [recepient_id], references: [id])
  salesPerson      Users?        @relation("SalesPersonRFQ", fields: [salesPersonId], references: [id])
  sender           Users?         @relation("senderRFQ", fields: [sender_id], references: [id])
  response         RFQResponse[] @relation("rfqResponses")
  project          Project?      @relation("ProjectRFQ")

  @@map("rfq")
}

model RFQResponse {
  id               String        @id @default(uuid()) @db.Uuid
  files            Json       @default("[]")
  userId           String        @db.Uuid
  rfqId            String        @db.Uuid
  description      String        @default("")
  createdAt        DateTime      @default(now())
  status           RFQStatus     @default(RECEIVED)
  parentResponseId String?       @db.Uuid
  wbtStatus        RFQStatus     @default(SENT)
  file             File[]        @relation("rfqResponseFiles")
  parentResponse   RFQResponse?  @relation("ParentChildResponse", fields: [parentResponseId], references: [id],onDelete: Cascade)
  childResponses   RFQResponse[] @relation("ParentChildResponse")
  rfqResponses     RFQ           @relation("rfqResponses", fields: [rfqId], references: [id],onDelete: Cascade)
  user             Users         @relation("rfqresponseBy", fields: [userId], references: [id])

  @@map("rfqResponse")
}

model Notification {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())
  userID    String   @db.Uuid
  payload   Json
  delivered Boolean  @default(false)
  read      Boolean  @default(false)
  user      Users    @relation("Notification", fields: [userID], references: [id], onDelete: Cascade)

  @@map("notification")
}

model WorkingHours {
  id                String          @id @default(uuid()) @db.Uuid
  user_id           String          @db.Uuid
  task_id           String?         @db.Uuid
  status            WorkHourStatus
  start             DateTime?
  duration          Int             @default(0)
  end               DateTime?
  estimationTask_id String?         @db.Uuid
  estimationTask    EstimationTask? @relation("workingHourEstimationTask", fields: [estimationTask_id], references: [id], onDelete: Cascade)
  task              Task?           @relation("workingHourTask", fields: [task_id], references: [id], onDelete: Cascade)
  user              Users           @relation("workingHourUser", fields: [user_id], references: [id], onDelete: Cascade)

  @@map("workinghour")
}

model ChangeOrder {
  id          String             @id @default(uuid()) @db.Uuid
  project     String             @db.Uuid
  recipients  String             @db.Uuid
  remarks     String             @default("")
  changeOrder String             @default("")
  description String             @default("")
  sender      String             @db.Uuid
  sentOn      DateTime           @default(now())
  files       Json               @default("[]")
  stage       Stage              @default(IFA)
  status      COSTATUS           @default(NOT_REPLIED)
  reason      String             @default("")
  createdAt   DateTime           @default(now())
  coResponse  COResponse?        @relation("coResponse")
  isAproovedByAdmin   Boolean?   @default(false)
  isDeputyManagerAprooved     Boolean?         @default(false)
  isDeptManagerAprooved       Boolean?         @default(false)
  Project     Project            @relation("ChangeOrderProject", fields: [project], references: [id], onDelete: Cascade)
  Recipients  Users              @relation("ChangeOrderRecipients", fields: [recipients], references: [id], onDelete: Cascade)
  senders     Users              @relation("ChangeOrderSender", fields: [sender], references: [id], onDelete: Cascade)
  CoRefersTo  ChangeOrdertable[] @relation("CoRefersTo")
  file        File[]             @relation("changeorderFiles")


  @@map("changeorder")
}

model ChangeOrdertable {
  id             String      @id @default(uuid()) @db.Uuid
  description    String      @default("")
  referenceDoc   String      @default("")
  elements       String      @default("")
  QtyNo          Int         @default(0)
  remarks        String?     @default("")
  hours          Float       @default(0.0)

  cost           Float       @default(0.0)
  costUpdatedBy  String      @default("") // userId or role of the person who updated
  costUpdatedAt  DateTime?   // timestamp of last cost update

  CoId           String      @db.Uuid
  CoRefersTo     ChangeOrder @relation("CoRefersTo", fields: [CoId], references: [id],onDelete: Cascade)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  @@map("changeordertable")
}


model COResponse {
  id               String       @id @default(uuid()) @db.Uuid
  Status           COSTATUS     @default(NOT_REPLIED)
  description      String       @default("")
  CoId             String?      @unique @db.Uuid
  userId           String       @db.Uuid
  parentResponseId String?      @db.Uuid
  files       Json               @default("[]")
  COresponse       ChangeOrder?  @relation("coResponse", fields: [CoId], references: [id],onDelete: Cascade)
  parentResponse   COResponse?  @relation("ParentChildResponse", fields: [parentResponseId], references: [id],onDelete: Cascade)
  childResponses   COResponse[] @relation("ParentChildResponse")
  user             Users        @relation("COrespondedby", fields: [userId], references: [id])
  file             File[]       @relation("CoResponseFiles")
}

model JobStudy {
  id          String  @id @default(uuid()) @db.Uuid
  QtyNo       Int
  unitTime    Float   @default(0.0)
  execTime    Float   @default(0.0)
  projectId   String  @db.Uuid
  description String
  projects    Project @relation("projectJobStudy", fields: [projectId], references: [id], onDelete: Cascade)

  @@map("jobStudy")
}

model WBSActivity {
  id                     String     @id @default(uuid()) @db.Uuid
  type                   Activity
  name                   String
  createdAt              DateTime   @default(now())
  projectId              String     @db.Uuid
  templateKey            String     @default("")
  updatedAt              DateTime   @updatedAt
  stage                  Stage      @default(IFA)
  totalCheckHr           Int        @default(0)
  totalExecHr            Int        @default(0)
  totalQtyNo             Int        @default(0)
  totalCheckHrWithRework Float      @default(0.0)
  totalExecHrWithRework  Float      @default(0.0)
  subTasks               SubTasks[] @relation("subTasks")
  project                Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("wbsactivity")
}

model SubTasks {
  id                String      @id @default(uuid()) @db.Uuid
  description       String
  unitTime          Float       @default(0.0)
  CheckUnitTime     Float       @default(0.0)
  QtyNo             Int         @default(0)
  checkHr           Float       @default(0.0)
  execHr            Float       @default(0.0)
  projectID         String      @db.Uuid
  wbsactivityID     String      @db.Uuid
  createdAt         DateTime    @default(now())
  parentTemplateKey String      @default("")
  stage             Stage       @default(IFA)
  updatedAt         DateTime    @updatedAt
  project           Project     @relation("subTasksproject", fields: [projectID], references: [id], onDelete: Cascade)
  WBSACTIVITY       WBSActivity @relation("subTasks", fields: [wbsactivityID], references: [id], onDelete: Cascade)

  @@unique([wbsactivityID, parentTemplateKey, stage])
  @@map("subTasks")
}

model Group {
  id        String      @id @default(uuid()) @db.Uuid
  name      String
  adminId   String      @db.Uuid
  createdAt DateTime    @default(now())
  admin     Users       @relation("groupAdmin", fields: [adminId], references: [id])
  members   GroupUser[] @relation("groupOfUsers")
  messages  Message[]   @relation("groupMessages")

  @@map("group")
}

model GroupUser {
  id       String @id @default(uuid()) @db.Uuid
  memberId String @db.Uuid
  groupId  String @db.Uuid
  group    Group  @relation("groupOfUsers", fields: [groupId], references: [id],onDelete: Cascade)
  members  Users  @relation("groupMembers", fields: [memberId], references: [id])

  @@map("groupuser")
}

model Message {
  id                String   @id @default(uuid()) @db.Uuid
  createdAt         DateTime @default(now())
  senderId          String   @db.Uuid
  receiverId        String?  @db.Uuid
  groupId           String?  @db.Uuid
  contentCompressed Bytes?
  content           String?
  groups            Group?   @relation("groupMessages", fields: [groupId], references: [id])
  receiver          Users?   @relation("messageReceivedBy", fields: [receiverId], references: [id])
  sender            Users    @relation("messageSentBy", fields: [senderId], references: [id])
  taggedUsers       Users[]  @relation("TaggedUsers")

  @@map("message")
}

model File {
  id                   String              @id @default(uuid()) @db.Uuid
  originalName         String
  mimeType             String
  size                 Int
  path                 String
  hash                 String              @unique
  uploadedAt           DateTime            @default(now())
  lastAccess           DateTime?
  isArchived           Boolean             @default(false)
  projectId            String?             @db.Uuid
  fabricatorId         String?             @db.Uuid
  submittalsId         String?             @db.Uuid
  submittalsResponseId String?             @db.Uuid
  rfiId                String?             @db.Uuid
  rfiResponseId        String?             @db.Uuid
  rfqId                String?             @db.Uuid
  rfqResponseId        String?             @db.Uuid
  CoId                 String?             @db.Uuid
  CoResponseId         String?             @db.Uuid
  changeorder          ChangeOrder?        @relation("changeorderFiles", fields: [CoId], references: [id])
  CoResponse           COResponse?         @relation("CoResponseFiles", fields: [CoResponseId], references: [id])
  fabricator           Fabricator?         @relation("fabricatorFiles", fields: [fabricatorId], references: [id])
  project              Project?            @relation("projectFiles", fields: [projectId], references: [id])
  rfi                  RFI?                @relation("rfiFiles", fields: [rfiId], references: [id])
  rfiresponse          RFIResponse?        @relation("rfiResponseFiles", fields: [rfiResponseId], references: [id])
  rfq                  RFQ?                @relation("rfqFiles", fields: [rfqId], references: [id])
  rfqresponse          RFQResponse?        @relation("rfqResponseFiles", fields: [rfqResponseId], references: [id])
  submittals           Submittals?         @relation("submittalsFiles", fields: [submittalsId], references: [id])
  submittalsPesponse   SubmittalsResponse? @relation("submittalsResponseFiles", fields: [submittalsResponseId], references: [id])

  @@map("file")
}

model Estimation {
  estimationNumber String               @unique
  fabricatorName   String?
  projectName      String
  description      String?
  estimateDate     DateTime
  status           EstimationStatus     @default(DRAFT)
  assignedById     String?
  finalHours       Float?
  finalWeeks       Float?
  finalPrice       Float?
  files            Json?                 @default("[]")
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  rfqId            String?              @db.Uuid
  createdById      String               @db.Uuid
  id               String               @id @default(uuid()) @db.Uuid
  fabricatorId     String               @db.Uuid
  tools            String?
  startDate        DateTime             @default(now())
  isArchived       Boolean      @default(false)
  lineItemGroups   EstimationLineItemGroup[]  // multiple groups of line items
  tasks            EstimationTask[]
  template         EstimationTemplate?
  createdBy        Users                @relation("CreatedBy", fields: [createdById], references: [id])
  fabricators      Fabricator           @relation("estimationUnderFabricator", fields: [fabricatorId], references: [id])
  rfq              RFQ?                  @relation(fields: [rfqId], references: [id])

  @@map("estimations")
}

model EstimationTask {
  assignedById String         @db.Uuid
  status       TaskStatus     @default(ASSIGNED)
  startDate    DateTime?
  endDate      DateTime?
  notes        String?
  reviewNotes  String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  estimationId String         @db.Uuid
  assignedToId String         @db.Uuid
  reviewedById String?        @db.Uuid
  id           String         @id @default(uuid()) @db.Uuid
  files        Json?          @default("[]")
  isArchived  Boolean      @default(false)

  assignedTo   Users          @relation("AssignedEstimator", fields: [assignedToId], references: [id])
  assignedBy   Users          @relation("AssignedBy",fields: [assignedById],references: [id])
  estimation   Estimation     @relation(fields: [estimationId], references: [id])
  reviewedBy   Users?         @relation("ReviewedBy", fields: [reviewedById], references: [id])
  workinghours WorkingHours[] @relation("workingHourEstimationTask")
  comment      Comment[]      @relation("estComment")

  @@map("estimation_tasks")
}

model EstimationLineItemGroup {
  id           String                @id @default(uuid()) @db.Uuid
  name         String                // e.g., "Structural", "Electrical", "Phase 1"
  description  String?
  estimationId String                @db.Uuid
  estimation   Estimation            @relation(fields: [estimationId], references: [id], onDelete: Cascade)

  lineItems    EstimationLineItem[]  // each group can have many line items
}

model EstimationLineItem {
  id           String                     @id @default(uuid()) @db.Uuid
  scopeOfWork  String
  remarks      String
  quantity     Float?
  hoursPerQty  Float?
  totalHours   Float?
  weeks        Float?
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  groupId      String                     @db.Uuid
  group        EstimationLineItemGroup    @relation(fields: [groupId], references: [id], onDelete: Cascade)
}

model EstimationTemplate {
  detailingEstimatedHours   Float?
  detailingEstimatedPrice   Float?
  detailingEstimatedWeeks   Float?
  connectionDesignRequired  Boolean    @default(false)
  scopeSheetAvailable       Boolean    @default(false)
  steelConsidered           String?
  connectionDesignMainSteel Boolean    @default(false)
  connectionDesignMiscSteel Boolean    @default(false)
  peStampingIncluded        Boolean    @default(false)
  exclusionNotes            String?
  mainSteelConnectionPrice  Float?
  miscSteelDesignPrice      Float?
  createdAt                 DateTime   @default(now())
  updatedAt                 DateTime   @updatedAt
  estimationId              String     @unique @db.Uuid
  id                        String     @id @default(uuid()) @db.Uuid
  estimation                Estimation @relation(fields: [estimationId], references: [id], onDelete: Cascade)

  @@map("estimation_templates")
}

model EstimatorEfficiency {
  estimatorId               String
  month                     Int 
  year                      Int
  totalEstimationsAssigned  Int      @default(0)
  totalEstimationsCompleted Int      @default(0)
  totalHoursSpent           Float    @default(0)
  averageTimePerEstimation  Float    @default(0)
  accuracyRate              Float?
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt
  id                        String   @id @default(uuid()) @db.Uuid

  @@unique([estimatorId, month, year])
  @@map("estimator_efficiency")
}

model Invoice {
  id                         String        @id @default(uuid()) @db.Uuid
  projectId                  String        @db.Uuid
  fabricatorId               String        @db.Uuid
  clientId                   String?        @db.Uuid @default("00000000-0000-0000-0000-000000000000")
  customerName               String        @default("")
  contactName                String        @default("")
  address                    String        @default("")
  stateCode                  String        @default("")
  GSTIN                      String        @default("")
  invoiceNumber              String
  invoiceDate                DateTime      @default(now())
  dateOfSupply               DateTime      @default(now())
  placeOfSupply              String        @default("")
  jobName                    String
  signature                  Json?         @default("[]")
  currencyType               String        @default("USD")
  totalInvoiceValue          Float         @default(0)
  totalInvoiceValueInWords   String        @default("")
  createdAt                  DateTime      @default(now())
  updatedAt                  DateTime      @updatedAt
  paymentStatus              Boolean       @default(false)
  createdBy                  String?        @db.Uuid

  // ðŸ”— Relations
  project                    Project       @relation("projectInvoice", fields: [projectId], references: [id])
  fabricator                 Fabricator    @relation("fabricatorInvoice", fields: [fabricatorId], references: [id])
  pointOfContact             Users[]         @relation("invoicePointOfContact")
  accountInfo                AccountInfo[] @relation("invoice")
  user                       Users?         @relation("invoiceCreatedBy",fields: [createdBy],references: [id])
  invoiceItems               InvoiceItem[]  
}

model InvoiceItem {
  id             String   @id @default(uuid()) @db.Uuid
  invoiceId      String   @db.Uuid
  description    String
  sacCode        String?
  unit           Int?
  rateUSD        Float?
  totalUSD       Float?
  remarks        String?
  createdAt      DateTime @default(now())

  // ðŸ”— Relation
  invoice        Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

model AccountInfo {
  id                  String   @id @default(uuid()) @db.Uuid
  invoiceId           String?   @db.Uuid
  abaRoutingNumber    String
  accountNumber       String
  accountType         String
  beneficiaryInfo     String
  beneficiaryAddress  String
  bankInfo            String
  bankAddress         String
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  // ðŸ”— Relation
  invoice             Invoice?  @relation("invoice", fields: [invoiceId], references: [id])
}

model FileShareLink {
  id         String   @id @default(uuid())
  token      String   @unique
  parentTable  String   // e.g. "notes", "projects", "todos"
  parentId     String   // the primary key of Notes/Project/etc
  fileId       String   // id inside JSON array
  createdAt    DateTime @default(now())
  expiresAt    DateTime?
}



enum EstimationStatus {
  DRAFT
  IN_PROGRESS
  PENDING_REVIEW
  APPROVED
  REJECTED
  RE_ESTIMATION_REQUIRED
  QUOTED
}

enum TaskStatus {
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  UNDER_REVIEW
  APPROVED
  REJECTED
  REVISION_REQUIRED
  BREAK
}

enum WorkHourStatus {
  START
  END
  PAUSE
  RESUME
}

enum UserRole {
  STAFF
  CLIENT
  VENDOR
  ADMIN
  SYSTEM_ADMIN
  SALES_PERSON
  DEPT_MANAGER
  ESTIMATION_HEAD
  ESTIMATOR
  PROJECT_MANAGER
  PROJECT_MANAGER_OFFICER
  DEPUTY_MANAGER
  OPERATION_EXECUTIVE
  CLIENT_ADMIN
  CLIENT_MANAGER
}

enum Status {
  ACTIVE
  ONHOLD
  INACTIVE
  DELAY
  COMPLETE
  ASSIGNED
}

enum Stage {
  RFI
  IFA
  BFA
  BFAM
  RIFA
  RBFA
  IFC
  BFC
  RIFC
  REV
  CO
  COMPLETED
  REWORK
  KICKOFF
}

enum Tools {
  TEKLA
  SDS2
  BOTH
  NO_PREFERENCE
}

enum Activity {
  MODELING
  DETAILING
  ERECTION
  MC
  DC
  EC
  DESIGNER
  DWG_CHECKING
  MODEL_CHECKING
  DETAIL_CHECKING
  ERECTION_CHECKING
  DESIGN_CHECKING
  OTHERS
}

enum State {
  PARTIAL
  COMPLETE
  OPEN
  SENT
  RECEIVED
  IN_REVIEW
}

enum RFQStatus {
  OPEN
  IN_REVIEW
  CLOSED
  APPROVED
  RE_APPROVAL
  RECEIVED
  ASSIGNED_FOR_ESTIMATION
  ESTIMATION_IN_PROGRESS
  ESTIMATION_COMPLETED
  QUOTED
  AWARDED
  REJECTED
  RE_ESTIMATION_REQUESTED
  SENT
}

enum SubResStatus {
  APPROVED
  PARTIAL
  NOT_APPROVED
}

enum COSTATUS {
  ACCEPT
  REJECT
  NOT_REPLIED
}
// Meeting status values
enum MeetingStatus {
  SCHEDULED   // Meeting is planned but not started
  ONGOING     // Meeting is currently happening
  COMPLETED   // Meeting has ended
  CANCELLED   // Meeting was cancelled
  RESCHEDULED // Meeting moved to another time
}

// RSVP values for attendees
enum RSVPStatus {
  ACCEPTED   // User accepted invitation
  DECLINED   // User declined
  MAYBE      // User marked as tentative
  PENDING    // User has not responded yet
}
enum MeetingRole {
  HOST        // Creator or main organizer of the meeting
  PRESENTER   // Allowed to present/share content
  ATTENDEE    // Regular participant
  OBSERVER    // Can join but not actively participate
}
